<template>
    <p>Incidents: {{incidents.length}}</p>

    <div class="card container text-start mt-2"
         v-for="incident in incidents"
         :key="incident.incidentId"
         @click="goToDetails(incident.incidentId)">
      <div class="card-header row justify-content-between">
        <b class="col text-start"><span class="badge bg-warning-subtle text-dark me-3">{{ incident.incidentId }}</span>{{ incident.titel }}</b>
        <b class="col text-center">assigned to: <span class="badge bg-info-subtle text-dark-emphasis">{{ incident.username }}</span></b>
        <span class="col text-end" v-bind="$attrs"><b>
          <p v-if="incident.isSolved">
          Status: <b>solved</b>
          </p>
          <p v-else>
          Status: <b class="badge bg-danger-subtle text-dark-emphasis">open</b>
          </p></b>
        </span>

      </div>
      <div class="card-body pt-1">
        <p class="card-text m-0 p-0">{{ incident.description }}</p>
        <p>Test</p>
        <div class="btn-group float-end">
          <button class="btn btn-outline-dark" v-on:click.stop="edit">Edit</button>
          <button class="btn btn-outline-dark" v-on:click.stop="deleteIncident(incident.id)">Delete</button>
        </div>
      </div>
    </div>
</template>

<script>
import axios from "axios";
import router from "../router/routes.js";
import {useAuth} from "../stores/auth.js";

const userdata = useAuth();

export default {
  name: 'IncidentTable',
  data(){
    return {
      token: userdata.token,
      incidents: [],
    };
  },
  created() {
    this.fetchIncidents();

  },
  methods: {
    async fetchIncidents() {
      const config = {
        headers: {
          Authorization: `Bearer ${this.token}`
        },
      };
      try {
        const response = await axios.get('api/incidents', config);
        this.incidents = response.data;
        } catch (error) {
        console.error('Error occurred fetching incidents:', error)
      }
    },
    goToDetails(id) {
      console.log(id);
      router.push({
        name: 'incident-details',
        params: {
          id: id
        }
      });
    },
    async deleteIncident(incidentId) {
      try {
        await axios.delete(`/api/incident/${incidentId}`);
        await this.fetchIncidents();
        await alert("deleted");
      } catch (error) {
        console.error('Error occurred deleting incidents:', error)
      }
    },
    edit() {
      alert("Edited");
  },



  }

};

</script>

<style>
.card:hover {
  -webkit-box-shadow: 5px 5px 12px -3px #878787;
  box-shadow: 5px 5px 12px -3px #878787;
}
.card {
  transition: box-shadow .5s;
}

</style>
